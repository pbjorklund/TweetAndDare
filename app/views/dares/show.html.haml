.page-header
  %h3
    - if @dare.owner.image
      .pull-left{ style: 'margin-right: 10px;'}
        = image_tag @dare.owner.image
    - if @dare.dared_user
      .pull-right{ style: 'margin-left: 10px;'}
        = image_tag @dare.dared_user.image

    = twitter_link @dare.owner.nickname
    dared
    = twitter_link @dare.target
    to
    = @dare.text
.row
  .span12
    - if current_user
      =link_to dont_path(id: @dare.id), remote: true, class: "dont-count btn btn-large btn-danger" do
        Don't
        = @dare.dislikes.size
      =link_to do_path(id: @dare.id), remote: true, class: "do-count btn btn-large btn-success" do
        Do
        = @dare.likes.size
      %h2
        Current state
        %br
        - Dare::STATES.keys[1..-1].each do |k|
          - if @dare.state == Dare::STATES[k]
            = pretty_state(Dare::STATES[k], true)
          - else
            = pretty_state(Dare::STATES[k])
.row
  .span12
    - if current_user == @dare.owner && @dare.state == Dare::STATES[:accepted]
      = form_for(@dare, :action => :update) do |f|
        = f.label "Change state"
        = f.select :state, { :completed => Dare::STATES[:completed], :failed => Dare::STATES[:failed] }
        %br
        = f.submit "Update", :class => "btn"
    - elsif @dare.state == Dare::STATES[:new]
      = form_for(@dare, :action => :update) do |f|
        = raw "<input type='hidden' name='dare[state]' value='#{Dare::STATES[:accepted]}'></hidden>"
        %br
        = f.submit "Accept", :class => "btn"

%center
  = render "disqus/disqus"
